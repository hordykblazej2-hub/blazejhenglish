<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Szkoła językowa – Błażej Hordyk | Kursy online</title>
<meta name="description" content="Kursy angielskiego online. Rezerwacja terminu, płatności online, cennik oraz rekrutacja lektorów – wszystko w jednym miejscu.">
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#f9fafb; --panel:#ffffff; --ink:#111827; --text:#374151; --muted:#6b7280;
  --brand:#2563eb; --accent:#f59e0b; --ring:#e5e7eb; --radius:18px;
  --ok:#16a34a; --danger:#ef4444;
}
*{box-sizing:border-box} html,body{margin:0;padding:0}
body{font-family:Manrope,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.65}
a{text-decoration:none;color:inherit}
.wrap{width:min(1160px,92%);margin:auto}

/* Header / nav */
.topbar{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--ring);backdrop-filter:saturate(180%) blur(12px)}
.topbar .inner{display:flex;align-items:center;justify-content:space-between;padding:.9rem 0}
.brand{font-weight:900;color:var(--ink);letter-spacing:.2px}
.brand span{color:var(--brand)}
.nav{display:flex;gap:1rem;flex-wrap:wrap}
.nav a{font-weight:700;color:var(--ink)}
.nav a:hover{color:var(--brand)}
.subnav{display:flex;gap:.6rem;flex-wrap:wrap;font-size:.92rem}
.subnav a{padding:.35rem .65rem;border:1px solid var(--ring);border-radius:999px}
.btn{display:inline-flex;align-items:center;justify-content:center;border-radius:999px;font-weight:800;padding:.75rem 1.15rem;border:1px solid var(--ring);background:#fff;color:#111;cursor:pointer}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
.btn.accent{background:var(--accent);border-color:var(--accent);color:#111}
.btn.green{background:var(--ok);border-color:var(--ok);color:#fff}
.btn.ghost{background:transparent;border-color:var(--ring)}
.small{font-size:.92rem} .tiny{font-size:.86rem} .muted{color:var(--muted)}
.notice{background:#eef2ff;border:1px solid #dbeafe;padding:.55rem .7rem;border-radius:12px}

/* Router views */
.view{display:none}
.view.active{display:block}

/* Hero */
.hero{
  position:relative;color:#fff;
  --img: var(--hero, url('ja.jpg'));
  background-image:linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.55)), var(--img);
  background-size:cover; background-position:center;
}
.hero .wrap{display:grid;grid-template-columns:1.15fr .85fr;gap:2rem;align-items:center;padding:3.6rem 0}
.hero .panel{background:rgba(255,255,255,.1);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.25);border-radius:22px;padding:1.2rem}
.hero h1{margin:.2rem 0 .6rem;font-size:clamp(2rem,4.8vw,3.2rem);color:#fff}
.hero p{color:#e7eaff;max-width:48ch;margin:.4rem 0 1rem}
.hero img{width:100%;border-radius:20px;box-shadow:0 18px 50px rgba(0,0,0,.25)}

/* Sekcje */
.section{padding:3rem 0}
h2{color:var(--ink);font-size:clamp(1.6rem,3.2vw,2.2rem);margin:0 0 1rem}
.lead{color:var(--muted);max-width:70ch}

/* Panele / karty */
.panel{background:var(--panel);border:1px solid var(--ring);border-radius:var(--radius);box-shadow:0 6px 16px rgba(0,0,0,.05)}
.panel.pad{padding:1.1rem}
.cards{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem}
.card{background:#fff;border:1px solid var(--ring);border-radius:16px;padding:1rem;box-shadow:0 6px 14px rgba(0,0,0,.04)}
.card h3{margin:.2rem 0 .4rem;color:var(--brand)}
.list{display:grid;gap:.6rem}
.kv{display:grid;grid-template-columns:180px 1fr;gap:.6rem}
.hr{border:none;border-top:1px solid var(--ring);margin:1rem 0}
.tag{padding:.25rem .55rem;border-radius:999px;border:1px solid var(--ring);font-weight:700;font-size:.8rem;color:#1f2937;background:#fff}
.tags{display:flex;gap:.4rem;flex-wrap:wrap;margin:.4rem 0}

/* Filtry i pola */
.filters{display:flex;gap:.6rem;flex-wrap:wrap;margin-bottom:.8rem}
.input,select{padding:.6rem .75rem;border:1px solid var(--ring);border-radius:12px;background:#fff;font:inherit}

/* Profil lektora */
.profile{display:grid;grid-template-columns:1fr 1.1fr;gap:1.2rem}
.profile .hero-box{display:flex;gap:1rem}
.profile .hero-box img{width:120px;height:120px;border-radius:16px;object-fit:cover;border:1px solid var(--ring)}
.meta{display:flex;gap:.4rem;flex-wrap:wrap}
.meta .tag{background:#eef2ff;border-color:#dbeafe}
.iframe-card{border:0;width:100%;height:780px;border-radius:14px}

/* Cennik & kalkulatory */
.pricing-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:.6rem}
.price-card{background:#fff;border:1px solid var(--ring);border-radius:16px;padding:1rem;text-align:center;box-shadow:0 8px 22px rgba(0,0,0,.06)}
.price-card h3{margin:.2rem 0}
.price{font-size:1.6rem;font-weight:800;margin:.2rem 0 .4rem}
.badge{display:inline-block;padding:.25rem .55rem;border-radius:999px;background:#f1f5ff;border:1px solid #dbeafe;color:#1f3a8a;font-weight:800;font-size:.8rem}
.price-card.featured{outline:3px solid rgba(37,99,235,.2)}
.calc{display:grid;grid-template-columns:repeat(5,1fr);gap:.8rem;align-items:end;margin-top:1rem}
.calc label{display:block;font-weight:800;font-size:.95rem;color:var(--ink)}
.calc input,.calc select{width:100%;padding:.6rem .75rem;border:1px solid var(--ring);border-radius:12px;background:#fff;color:#var(--text);font:inherit}
.calc .btn{grid-column:span 1}
.calc__result{grid-column:1 / -1;background:#f6f9ff;border:1px dashed #c7d2fe;border-radius:12px;padding:.7rem .8rem;font-weight:700}

/* FAQ / timeline / prose */
.faq details{background:#fff;border:1px solid var(--ring);border-radius:12px;padding:.6rem .8rem;margin:.5rem 0}
.faq summary{cursor:pointer;font-weight:800;color:var(--ink)}
.timeline{position:relative;padding-left:1.2rem}
.timeline::before{content:"";position:absolute;left:.4rem;top:.2rem;bottom:.2rem;width:2px;background:#dbeafe}
.timeline .t{position:relative;margin:.6rem 0;padding-left:.8rem}
.timeline .t::before{content:"";position:absolute;left:-1.05rem;top:.35rem;width:10px;height:10px;border-radius:50%;background:#2563eb}
.prose{max-width:80ch}
.prose h3{margin:1rem 0 .4rem;color:var(--ink)}
.prose p{margin:.4rem 0}
.prose ul{margin:.4rem 0 .6rem 1.1rem}
.prose li{margin:.25rem 0}

/* Stopka */
.footer{background:#111827;color:#cfd3dc;padding:2rem 0;margin-top:2rem;border-top:1px solid #0b1220}
.footer .wrap{display:flex;justify-content:space-between;gap:1rem;flex-wrap:wrap}
.footer a{color:#e5e7eb}

/* Kalendarz + edytor profilu (panel) */
.cal{background:#fff;border:1px solid var(--ring);border-radius:16px;padding:.8rem}
.cal-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:.5rem}
.cal-header .btn{padding:.45rem .7rem}
.cal-week{display:grid;grid-template-columns:repeat(7,1fr);gap:.3rem;font-weight:800;color:#6b7280;margin:.3rem 0}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:.4rem}
.cal-cell{border:1px solid var(--ring);border-radius:10px;padding:.35rem .4rem;min-height:90px;background:#fff;position:relative;cursor:pointer}
.cal-cell .d{font-weight:800;color:#111}
.cal-cell.today{outline:2px solid rgba(37,99,235,.25)}
.cal-cell.other{opacity:.45}
.cal-cell .dots{position:absolute;right:.35rem;bottom:.35rem;display:flex;gap:3px}
.cal-cell .dot{width:8px;height:8px;border-radius:50%;background:var(--brand)}
.cal-cell .dot.bad{background:var(--danger)}
.ev{border:1px solid var(--ring);border-radius:8px;padding:.45rem .55rem;margin:.35rem 0}
.ev.free{background:#f6f9ff}
.ev.booked{background:#fef3c7}
.ev .actions{display:flex;gap:.4rem;margin-top:.35rem}
.profile-editor .grid{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
.profile-editor .grid .span-2{grid-column:1/-1}

/* Avatar uploader */
.avatar-box{display:flex;gap:1rem;align-items:flex-start;margin:.6rem 0}
.avatar-box img{width:96px;height:96px;border-radius:12px;object-fit:cover;border:1px solid var(--ring);background:#fff}

/* RWD */
@media (max-width: 980px){
  .hero .wrap{grid-template-columns:1fr}
  .cards{grid-template-columns:1fr 1fr}
  .pricing-grid{grid-template-columns:1fr}
  .profile{grid-template-columns:1fr}
  .calc{grid-template-columns:1fr 1fr 1fr;align-items:start}
  .calc .btn{grid-column:1 / -1}
}
@media (max-width: 720px){
  .cards{grid-template-columns:1fr}
  .kv{grid-template-columns:1fr}
  .profile-editor .grid{grid-template-columns:1fr}
}
</style>
</head>
<body>

<header class="topbar">
  <div class="wrap inner">
    <a class="brand" href="#home">Błażej <span>Hordyk</span> • Kursy językowe</a>
    <nav class="nav">
      <a href="#home">Start</a>
      <a href="#lektorzy">Lektorzy</a>
      <a href="#kursy">Kursy</a>
      <a href="#cennik">Cennik</a>
      <a href="#blog">Blog</a>
      <a href="#kontakt">Kontakt</a>
      <a href="#mapa-strony">Więcej</a>
      <a id="navPanel" href="#panel" style="display:none">Panel</a>
      <a id="navLogin" href="#login">Zaloguj</a>
      <a id="navLogout" href="#" style="display:none">Wyloguj</a>
    </nav>
  </div>
</header>

<!-- ========== HOME ========== -->
<main id="view-home" class="view active">
  <section class="hero">
    <div class="wrap">
      <div class="panel">
        <h1>Angielski online – szkoła, która naprawdę wspiera</h1>
        <p>Cześć, tu <strong>Błażej Hordyk</strong>. Kursy 1:1, elastyczne terminy, empatyczni lektorzy. Od podstaw, w pracy i do egzaminów.</p>
        <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem">
          <a class="btn primary" href="#lektorzy">Poznaj lektorów</a>
          <a class="btn ghost" href="#probna">Lekcja próbna</a>
          <a class="btn ghost" href="#test">Test poziomujący</a>
        </div>
        <div class="subnav" style="margin-top:.6rem">
          <a href="#business-english">Business English</a>
          <a href="#ielts">IELTS</a>
          <a href="#fce">FCE</a>
          <a href="#b2b-rozwiązania">Dla firm</a>
          <a href="#opinie">Opinie</a>
        </div>
      </div>
      <img src="file:///Users/blazej/Downloads/ChatGPT%20Image%20Sep%208,%202025,%2011_40_01%20AM.png" alt="Nauka online – laptop i notatki">
    </div>
  </section>

  <section class="section" id="home-oferta">
    <div class="wrap">
      <h2>Co oferujemy?</h2>
      <p class="lead">Indywidualne kursy 1:1 — plan dopasowany do celu, czasu i stylu nauki. Bez stresu – w Twoim tempie.</p>
      <div class="cards">
        <article class="card"><h3>Od podstaw</h3><p>Jasne wyjaśnienia, mówienie od pierwszych zajęć.</p></article>
        <article class="card"><h3>Business English</h3><p>Maile, spotkania, prezentacje – pewność w pracy.</p></article>
        <article class="card"><h3>Egzaminy</h3><p>FCE/IELTS – strategie, próbne testy i feedback.</p></article>
      </div>
    </div>
  </section>
</main>

<!-- ========== LEKTORZY (lista) ========== -->
<main id="view-lektorzy" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Nasi lektorzy</h2>
      <p class="lead">Wybierz lektora pasującego do Twojego celu.</p>
      <div class="filters">
        <input id="filterName" class="input" type="search" placeholder="Szukaj po imieniu / specjalizacji">
        <select id="filterSpec">
          <option value="all">Wszystkie specjalizacje</option>
          <option>od podstaw</option><option>angielski do pracy</option><option>konwersacje</option>
          <option>Business English</option><option>prezentacje</option><option>rozmowy rekrutacyjne</option>
          <option>FCE/IELTS</option><option>gramatyka jasno</option><option>strategie egzaminacyjne</option>
        </select>
      </div>
      <div id="tutorsList" class="grid"></div>
    </div>
  </section>
</main>

<!-- ========== PROFIL LEKTORA (publiczny) ========== -->
<main id="view-lektor" class="view">
  <section class="section"><div class="wrap profile" id="profileBox"></div></section>
</main>

<!-- ========== KURSY ========== -->
<main id="view-kursy" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Nasze kursy</h2>
      <p class="lead">Wybierz ścieżkę pod cel: praca, egzamin lub swoboda mówienia.</p>
      <div class="cards">
        <article class="card"><h3>Od podstaw</h3><p>Fundamenty i przełamana bariera mówienia.</p><p><a class="btn ghost small" href="#probna">Lekcja próbna</a></p></article>
        <article class="card"><h3>Business English</h3><p>Maile, spotkania, prezentacje; realne scenariusze.</p><p><a class="btn ghost small" href="#business-english">Zobacz landing</a></p></article>
        <article class="card"><h3>Egzaminy</h3><p>IELTS / FCE – strategia + praktyka.</p><p><a class="btn ghost small" href="#ielts">IELTS</a> <a class="btn ghost small" href="#fce">FCE</a></p></article>
      </div>
    </div>
  </section>
</main>

<!-- ========== CENNIK ========= -->
<main id="view-cennik" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Cennik</h2>
      <p class="lead">Ceny orientacyjne dla zajęć 1:1 online.</p>
      <div class="pricing-grid">
        <article class="price-card"><span class="badge">Start</span><h3>1 × 60 min</h3><p class="price">XX zł</p><p class="small muted">Na próbę lub konsultacje.</p><p><a href="#sklep" class="btn ghost small">Kup</a></p></article>
        <article class="price-card featured"><span class="badge">Najczęściej</span><h3>4 × 60 min</h3><p class="price">XX zł</p><p class="small muted">Stały rytm + priorytet grafiku.</p><p><a href="#sklep" class="btn primary small">Kup pakiet</a></p></article>
        <article class="price-card"><span class="badge">Progres</span><h3>8 × 60 min</h3><p class="price">XX zł</p><p class="small muted">Najlepsza dynamika.</p><p><a href="#sklep" class="btn ghost small">Kup</a></p></article>
      </div>

      <div class="panel pad" style="margin-top:1rem">
        <h3>Policz swój pakiet</h3>
        <div class="calc">
          <label>Stawka / godz.<input type="number" id="rate" value="120" min="1" step="1"></label>
          <label>Czas lekcji<select id="duration"><option value="60" selected>60 min</option><option value="45">45 min</option></select></label>
          <label>Liczba lekcji<select id="lessons"><option>1</option><option selected>4</option><option>8</option><option>12</option></select></label>
          <button class="btn primary" id="calcBtn">Przelicz</button>
          <div class="calc__result" id="calcResult" aria-live="polite">Wybierz parametry i kliknij „Przelicz”.</div>
        </div>
        <p class="tiny muted">Rabat: 8 lekcji → 5%, 12 lekcji → 10%.</p>
      </div>
    </div>
  </section>
</main>

<!-- ========== BLOG (lista) ========= -->
<main id="view-blog" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Blog</h2>
      <div class="filters">
        <select id="blogCat"><option value="all">Wszystkie kategorie</option><option value="business">Business</option><option value="egzaminy">Egzaminy</option><option value="od-podstaw">Od podstaw</option><option value="wymowa">Wymowa</option></select>
        <input id="blogQ" class="input" placeholder="Szukaj na blogu">
      </div>
      <div id="blogList" class="cards"></div>
    </div>
  </section>
</main>

<!-- ========== POST ========= -->
<main id="view-post" class="view">
  <section class="section"><div class="wrap"><article class="panel pad" id="postBox"></article><p style="margin-top:.6rem"><a class="btn ghost small" href="#blog">← Wróć do bloga</a></p></div></section>
</main>

<!-- ========== O NAS ========= -->
<main id="view-o-nas" class="view">
  <section class="section">
    <div class="wrap">
      <h2>O nas</h2>
      <p class="lead">Uczymy bez stresu, jasno i praktycznie. Stawiamy na mówienie i realny postęp.</p>
      <div class="panel pad"><div class="kv"><div><strong>Misja</strong></div><div>Pomóc Ci mówić swobodnie i z radością.</div><div><strong>Metoda</strong></div><div>Krótki wstęp + dużo mówienia. Realne sytuacje.</div><div><strong>Zespół</strong></div><div>Empatia + konkret. Kurs szyty na miarę.</div></div></div>
    </div>
  </section>
</main>

<!-- ========== B2B (landing) ========= -->
<main id="view-b2b-rozwiązania" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Rozwiązania dla firm</h2>
      <p class="lead">Programy Business English dla zespołów: 1:1 i mikro-grupy. Raporty, cele kwartalne, faktury.</p>
      <div class="cards">
        <article class="card"><h3>IT</h3><p>Stand-upy, code reviews, demos. Słownictwo projektowe.</p></article>
        <article class="card"><h3>Sprzedaż</h3><p>Discovery calls, objections, closing. Skrypty i role-plays.</p></article>
        <article class="card"><h3>HR / Leadership</h3><p>Feedback, performance reviews, difficult talks.</p></article>
      </div>
      <div class="panel pad" style="margin-top:1rem"><h3>Brief dla HR</h3><p><a class="btn primary small" href="#brief">Wypełnij brief</a> • <a class="btn ghost small" href="#case">Zobacz case studies</a> • <a class="btn ghost small" href="#b2b-cennik">Cennik B2B</a></p></div>
    </div>
  </section>
</main>

<!-- ========== CASE STUDIES ========= -->
<main id="view-case" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Case studies</h2>
      <div class="cards" id="caseList"></div>
    </div>
  </section>
</main>

<!-- ========== ROI ========= -->
<main id="view-roi" class="view">
  <section class="section">
    <div class="wrap panel pad">
      <h2>Kalkulator ROI szkoleń</h2>
      <div class="calc">
        <label>Stawka godz. zespołu (PLN)<input type="number" id="roiRate" value="150"></label>
        <label>Godzin spotkań / tydz.<input type="number" id="roiMeet" value="10"></label>
        <label>Redukcja czasu po szkoleniu (%)<input type="number" id="roiCut" value="15"></label>
        <label>Liczba osób<input type="number" id="roiPeople" value="6"></label>
        <button class="btn primary" id="roiBtn">Policz ROI</button>
        <div id="roiOut" class="calc__result">Wynik pojawi się tutaj.</div>
      </div>
      <p class="tiny muted">Szacunki: krótsze spotkania i mniej poprawek maili.</p>
    </div>
  </section>
</main>

<!-- ========== BRIEF B2B ========= -->
<main id="view-brief" class="view">
  <section class="section">
    <div class="wrap panel pad">
      <h2>Brief dla HR</h2>
      <form class="form" action="https://formspree.io/f/your_brief_id" method="POST">
        <label>Firma <input name="company" required></label>
        <label>Osób do przeszkolenia <input type="number" name="people" required></label>
        <label>Poziomy (A2–C1) <input name="levels" placeholder="np. A2–B2"></label>
        <label>Cele <textarea name="goals" rows="4" placeholder="np. skrócić spotkania, lepsze maile, prezentacje"></textarea></label>
        <label>Preferowane godziny <input name="times" placeholder="np. 8–10, 16–19"></label>
        <button class="btn primary" type="submit">Wyślij brief</button>
      </form>
    </div>
  </section>
</main>

<!-- ========== CENNIK B2B ========= -->
<main id="view-b2b-cennik" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Cennik B2B</h2>
      <div class="panel pad">
        <div class="kv">
          <div><strong>1:1 (60 min)</strong></div><div>od XX zł / os.</div>
          <div><strong>Mikro-grupa (2–4)</strong></div><div>od XX zł / os.</div>
          <div><strong>Warsztaty tematyczne</strong></div><div>zapytaj — wycena indywidualna</div>
          <div><strong>SLA / raporty</strong></div><div>miesięczne podsumowania, cele kwartalne</div>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- ========== KARIERA ========= -->
<main id="view-kariera" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Kariera lektora</h2>
      <div class="timeline panel pad">
        <div class="t"><strong>1. Aplikacja</strong> – formularz, krótkie demo.</div>
        <div class="t"><strong>2. Onboarding</strong> – standardy, materiały, narzędzia.</div>
        <div class="t"><strong>3. Start</strong> – wsparcie metodyczne, feedback.</div>
      </div>
      <p style="margin-top:.6rem"><a class="btn primary small" href="#rekrutacja">Dołącz do zespołu</a> • <a class="btn ghost small" href="#lektor-faq">FAQ lektora</a></p>
    </div>
  </section>
</main>

<!-- ========== MATERIAŁY DLA LEKTORÓW ========= -->
<main id="view-lektor-materialy" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Baza materiałów dla lektorów</h2>
      <p class="lead">Dostęp dla zalogowanych lektorów.</p>
      <div id="lmBox" class="panel pad">Sprawdzam dostęp…</div>
    </div>
  </section>
</main>

<!-- ========== FAQ LEKTORA ========= -->
<main id="view-lektor-faq" class="view">
  <section class="section">
    <div class="wrap">
      <h2>FAQ lektora</h2>
      <div class="faq">
        <details open><summary>Grafiki i odwołania</summary><p>Zmiany min. 24h przed terminem. Odwołania przez panel.</p></details>
        <details><summary>Standard lekcji</summary><p>Krótka rozgrzewka, cele lekcji, praktyka mówienia, mini-zadanie.</p></details>
        <details><summary>Feedback</summary><p>Po każdej lekcji 2–3 zdania podsumowania + „następny krok”.</p></details>
      </div>
    </div>
  </section>
</main>

<!-- ========== SKLEP ========= -->
<main id="view-sklep" class="view">
  <section class="section">
    <div class="wrap">
      <h2>Sklep – pakiety zajęć</h2>
      <div class="cards" id="shopList"></div>
      <p class="tiny muted">Płatności: Stripe/Przelewy24. Po opłaceniu otrzymasz potwierdzenie e-mail.</p>
    </div>
  </section>
</main>

<!-- ========== LANDING: IELTS ========= -->
<main id="view-ielts" class="view">
  <section class="section"><div class="wrap">
    <h2>IELTS – przygotowanie</h2>
    <div class="panel pad"><div class="kv"><div><strong>Cel</strong></div><div>Wynik 6.5–7.5</div><div><strong>Fokus</strong></div><div>Writing Task 1/2, Speaking Part 2, Listening</div><div><strong>Materiały</strong></div><div>Cambridge, mock tests, feedback pisemny</div></div></div>
    <p style="margin-top:.6rem"><a class="btn primary small" href="#probna">Umów lekcję próbną</a></p>
  </div></section>
</main>

<!-- ========== LANDING: FCE ========= -->
<main id="view-fce" class="view">
  <section class="section"><div class="wrap">
    <h2>FCE – przygotowanie</h2>
    <div class="panel pad"><div class="kv"><div><strong>Cel</strong></div><div>Poziom B2</div><div><strong>Fokus</strong></div><div>Use of English, Writing, Speaking</div><div><strong>Narzędzia</strong></div><div>Testy próbne, strategie, check-listy</div></div></div>
    <p style="margin-top:.6rem"><a class="btn primary small" href="#probna">Umów lekcję próbną</a></p>
  </div></section>
</main>

<!-- ========== LANDING: BUSINESS ENGLISH ========= -->
<main id="view-business-english" class="view">
  <section class="section"><div class="wrap">
    <h2>Business English</h2>
    <div class="cards">
      <article class="card"><h3>Maile</h3><p>Concise, polite, action-oriented. Szablony.</p></article>
      <article class="card"><h3>Spotkania</h3><p>Facylitacja, feedback, podejmowanie decyzji.</p></article>
      <article class="card"><h3>Prezentacje</h3><p>Struktura, narracja, Q&A. Pitch deck.</p></article>
    </div>
    <p style="margin-top:.6rem"><a class="btn primary small" href="#probna">Lekcja próbna</a></p>
  </div></section>
</main>

<!-- ========== PROGRAM POLECEŃ ========= -->
<main id="view-polecenia" class="view">
  <section class="section"><div class="wrap panel pad">
    <h2>Program poleceń</h2>
    <p class="lead">Poleć znajomemu i odbierz <strong>-10%</strong> dla siebie i dla niego.</p>
    <div class="calc">
      <label>Twoje imię <input id="refName" placeholder="np. Ania"></label>
      <label>Twój e-mail <input id="refMail" placeholder="ania@example.com"></label>
      <button class="btn primary" id="mkRef">Wygeneruj link</button>
      <div id="refOut" class="calc__result">Twój link polecający pojawi się tutaj.</div>
    </div>
  </div></section>
</main>

<!-- ========== OPINIE ========= -->
<main id="view-opinie" class="view">
  <section class="section"><div class="wrap">
    <h2>Opinie kursantów</h2>
    <div id="opinieList" class="list"></div>
  </div></section>
</main>

<!-- ========== LEKCJA PRÓBNA ========= -->
<main id="view-probna" class="view">
  <section class="section"><div class="wrap">
    <h2>Lekcja próbna</h2>
    <div class="panel pad">
      <p>30 minut rozmowy: cele, poziom, dopasowanie planu. Bez zobowiązań.</p>
      <form class="form" action="https://formspree.io/f/your_trial_id" method="POST" style="max-width:560px">
        <label>Imię <input name="name" required></label>
        <label>E-mail <input type="email" name="email" required></label>
        <label>Preferowane godziny <input name="time" placeholder="np. pn-czw 18–20"></label>
        <button class="btn primary">Umów rozmowę</button>
      </form>
    </div>
  </div></section>
</main>

<!-- ========== FAQ rozszerzone ========= -->
<main id="view-faq-rozszerzone" class="view">
  <section class="section"><div class="wrap">
    <h2>FAQ – rozszerzone</h2>
    <div class="faq">
      <details open><summary>Odwołania i zmiany</summary><p>Do 24h przed terminem – bezpłatnie. Później lekcja liczona.</p></details>
      <details><summary>Faktury</summary><p>Wystawiamy dla osób i firm. Dane w formularzu zapisu.</p></details>
      <details><summary>Materiały</summary><p>Udostępniamy notatki i zadania po lekcji.</p></details>
      <details><summary>RODO</summary><p>Dane przetwarzamy tylko w celu realizacji usług i rozliczeń.</p></details>
    </div>
  </div></section>
</main>

<!-- ========== SŁOWNIK ========= -->
<main id="view-slownik" class="view">
  <section class="section"><div class="wrap">
    <h2>Słownik / frazy przydatne</h2>
    <div class="filters"><input id="dictQ" class="input" placeholder="Szukaj frazy..."><select id="dictCat"><option value="all">Wszystkie</option><option>business</option><option>spotkania</option><option>egzaminy</option></select></div>
    <div id="dictList" class="list"></div>
  </div></section>
</main>

<!-- ========== WYDARZENIA (public) ========= -->
<main id="view-wydarzenia" class="view">
  <section class="section"><div class="wrap">
    <h2>Wydarzenia otwarte</h2>
    <div id="eventsOpen" class="list"></div>
    <p class="tiny muted">Chcesz własny termin? <a href="#kontakt">Napisz do nas</a>.</p>
  </div></section>
</main>

<!-- ========== TEST POZIOMUJĄCY ========= -->
<main id="view-test" class="view">
  <section class="section"><div class="wrap">
    <h2>Test poziomujący (5 pytań)</h2>
    <form id="testForm" class="panel pad list" style="max-width:720px">
      <div><strong>1.</strong> I ____ to the gym yesterday.
        <div class="tags"><label><input type="radio" name="q1" value="went"> went</label><label><input type="radio" name="q1" value="go"> go</label></div>
      </div>
      <div><strong>2.</strong> If I ____ more time, I would travel.
        <div class="tags"><label><input type="radio" name="q2" value="had"> had</label><label><input type="radio" name="q2" value="have"> have</label></div>
      </div>
      <div><strong>3.</strong> She’s responsible ____ marketing.
        <div class="tags"><label><input type="radio" name="q3" value="for"> for</label><label><input type="radio" name="q3" value="of"> of</label></div>
      </div>
      <div><strong>4.</strong> The report must ____ by Friday.
        <div class="tags"><label><input type="radio" name="q4" value="be finished"> be finished</label><label><input type="radio" name="q4" value="finished"> finished</label></div>
      </div>
      <div><strong>5.</strong> Choose the best reply: “Would you mind sending the file?”
        <div class="tags"><label><input type="radio" name="q5" value="Not at all, I’ll send it now."> Not at all, I’ll send it now.</label><label><input type="radio" name="q5" value="Yes, I would."> Yes, I would.</label></div>
      </div>
      <button class="btn primary" type="submit">Zobacz wynik</button>
      <div id="testOut" class="notice" style="display:none"></div>
    </form>
  </div></section>
</main>

<!-- ========== MATERIAŁY (public) ========= -->
<main id="view-materialy" class="view">
  <section class="section"><div class="wrap">
    <h2>Materiały do nauki</h2>
    <div class="filters"><select id="matLevel"><option value="all">Wszystkie poziomy</option><option>A1</option><option>A2</option><option>B1</option><option>B2</option><option>C1</option></select><select id="matType"><option value="all">Wszystkie typy</option><option>PDF</option><option>Audio</option><option>Video</option></select></div>
    <div id="matList" class="cards"></div>
  </div></section>
</main>

<!-- ========== PLAN NAUKI ========= -->
<main id="view-plan" class="view">
  <section class="section"><div class="wrap">
    <h2>Plan nauki</h2>
    <div class="timeline panel pad">
      <div class="t"><strong>Tydz. 1–2:</strong> fundamenty + mini-rozmowy</div>
      <div class="t"><strong>Tydz. 3–4:</strong> praca z błędami + automatyzacja fraz</div>
      <div class="t"><strong>Tydz. 5–6:</strong> scenariusze z życia/pracy</div>
      <div class="t"><strong>Tydz. 7+ :</strong> utrwalenie + rozszerzenia</div>
    </div>
  </div></section>
</main>

<!-- ========== STREFA KURSANTA ========= -->
<main id="view-uczen" class="view">
  <section class="section"><div class="wrap">
    <h2>Strefa kursanta</h2>
    <div class="panel pad">
      <h3>Twoje notatki</h3>
      <textarea id="uNotes" rows="5" class="input" style="width:100%" placeholder="Zapisuj swoje cele, frazy i zadania..."></textarea>
      <div style="margin-top:.6rem;display:flex;gap:.6rem"><button id="uSave" class="btn primary small">Zapisz w przeglądarce</button><span id="uMsg" class="tiny muted"></span></div>
    </div>
    <div class="panel pad" style="margin-top:1rem">
      <h3>Harmonogram (przykład)</h3>
      <div id="uSchedule" class="list"></div>
    </div>
  </div></section>
</main>

<!-- ========== DOSTĘPNOŚĆ ========= -->
<main id="view-dostepnosc" class="view">
  <section class="section"><div class="wrap">
    <h2>Deklaracja dostępności (WCAG)</h2>
    <div class="panel pad prose">
      <p>Dbamy o dostępność: kontrast, nawigacja klawiaturą, teksty alternatywne.</p>
      <ul><li>Skróty: <kbd>Alt</kbd>+<kbd>1</kbd> – Start, <kbd>Alt</kbd>+<kbd>2</kbd> – Lektorzy</li><li>Tryb wysoki kontrast – wkrótce</li></ul>
      <p>Uwagi? Napisz: <a href="mailto:kontakt@twojadomena.pl">kontakt@twojadomena.pl</a></p>
    </div>
  </div></section>
</main>

<!-- ========== MAPA STRONY ========= -->
<main id="view-mapa-strony" class="view">
  <section class="section"><div class="wrap">
    <h2>Mapa strony</h2>
    <div id="sitemap" class="list"></div>
  </div></section>
</main>

<!-- ========== CENTRUM POMOCY ========= -->
<main id="view-help" class="view">
  <section class="section"><div class="wrap">
    <h2>Centrum pomocy</h2>
    <div class="faq">
      <details open><summary>Płatności</summary><p>Stripe/Przelewy24. Potwierdzenie e-mail po transakcji.</p></details>
      <details><summary>Odwołania</summary><p>Do 24h bezpłatnie, później lekcja liczona.</p></details>
      <details><summary>Logowanie</summary><p>Lektor: #login → #panel. Kursant: kontakt e-mail (wkrótce konto ucznia).</p></details>
      <details><summary>Problemy techniczne</summary><p>Sprawdź łącze, przeglądarkę, zaktualizuj Zoom/Meet.</p></details>
    </div>
  </div></section>
</main>

<!-- ========== COOKIES ========= -->
<main id="view-cookies" class="view">
  <section class="section"><div class="wrap">
    <h2>Ustawienia cookies</h2>
    <div class="panel pad">
      <label><input type="checkbox" id="cStat"> Statystyczne</label><br>
      <label><input type="checkbox" id="cMkt"> Marketingowe</label><br><br>
      <button class="btn primary small" id="cSave">Zapisz preferencje</button>
      <span id="cMsg" class="tiny muted" style="margin-left:.6rem"></span>
    </div>
  </div></section>
</main>

<!-- ========== STATUS ========= -->
<main id="view-status" class="view">
  <section class="section"><div class="wrap">
    <h2>Status systemu</h2>
    <div class="panel pad" id="statusBox">Wszystkie systemy działają prawidłowo.</div>
  </div></section>
</main>

<!-- ========== KONTAKT ========= -->
<main id="view-kontakt" class="view">
  <section class="section"><div class="wrap panel pad">
    <h2>Kontakt</h2>
    <p class="lead">Masz pytania? Napisz lub zadzwoń — odpowiemy tego samego dnia.</p>
    <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem">
      <a class="btn primary" href="mailto:kontakt@twojadomena.pl">✉ kontakt@twojadomena.pl</a>
      <a class="btn accent" href="tel:+48123123123">📱 +48 123 123 123</a>
      <a class="btn ghost" href="#probna">Umów lekcję próbną</a>
    </div>
  </div></section>
</main>

<!-- ========== REKRUTACJA ========= -->
<main id="view-rekrutacja" class="view">
  <section class="section"><div class="wrap">
    <h2>Dołącz do zespołu lektorów</h2>
    <div class="panel pad">
      <div class="notice tiny"><strong>Wskazówka:</strong> gdy brak CV, podaj LinkedIn i krótkie demo (3–5 min).</div>
      <form class="form" action="https://formspree.io/f/your_form_id" method="POST" style="margin-top:1rem">
        <label>Imię i nazwisko<input type="text" name="name" required></label>
        <label>E-mail<input type="email" name="email" required></label>
        <label>Specjalizacje<select name="spec" required><option disabled selected>Wybierz</option><option>Od podstaw</option><option>Business English</option><option>Egzaminy</option><option>Konwersacje</option></select></label>
        <label>Link do profilu / demo<input type="url" name="cv" placeholder="https://..."></label>
        <label>Doświadczenie i dostępność<textarea name="message" rows="5" required></textarea></label>
        <button class="btn green">Wyślij zgłoszenie</button>
      </form>
    </div>
  </div></section>
</main>

<!-- ========== LOGIN ========= -->
<main id="view-login" class="view">
  <section class="section"><div class="wrap panel pad">
    <h2>Logowanie lektora</h2>
    <form id="loginForm" class="form" style="max-width:520px">
      <label>E-mail<input type="email" id="loginEmail" required placeholder="jan@szkola.pl"></label>
      <label>Hasło<input type="password" id="loginPassword" required placeholder="••••••••"></label>
      <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem">
        <button class="btn primary" type="submit">Zaloguj</button>
        <button class="btn ghost" type="button" id="registerBtn">Zarejestruj</button>
      </div>
      <p class="tiny muted">Jeśli nie masz konta, kliknij „Zarejestruj”.</p>
      <div id="loginMsg" class="tiny muted" style="margin-top:.4rem"></div>
    </form>
  </div></section>
</main>

<!-- ========== PANEL LEKTORA (EDYTOR + KALENDARZ + AVATAR) ========== -->
<main id="view-panel" class="view">
  <section class="section">
    <div class="wrap">
      <div class="panel pad profile-editor">
        <h2>Panel lektora</h2>
        <p class="lead">Witaj, <span id="meName">—</span>. Tu edytujesz profil i zarządzasz grafikiem.</p>
        <div class="kv" style="margin:.6rem 0 1rem">
          <div><strong>E-mail</strong></div><div id="meEmail">—</div>
          <div><strong>Publiczny profil</strong></div><div id="mePublic">—</div>
        </div>

        <h3>Edytuj profil</h3>
        <form id="profileForm" class="form">
          <div class="grid">
            <label>Imię i nazwisko
              <input id="pf_name" required>
            </label>
            <label>Tytuł (np. „Business English”)
              <input id="pf_title" placeholder="np. Lektor • konwersacje bez stresu">
            </label>
            <label class="span-2">Bio (krótki opis)
              <textarea id="pf_bio" rows="4" placeholder="Krótko o sobie"></textarea>
            </label>
            <label>Stawka (PLN / 60 min)
              <input id="pf_rate" type="number" min="1" step="1">
            </label>
            <label>Specjalizacje (po przecinku)
              <input id="pf_specs" placeholder="np. Business English, konwersacje, FCE/IELTS">
            </label>
            <label>Booking URL (Calendly/Cal.com)
              <input id="pf_booking" placeholder="https://...">
            </label>

            <!-- AVATAR UPLOADER -->
            <div class="span-2">
              <label>Avatar</label>
              <div class="avatar-box">
                <img id="pf_avatar_preview" alt="Podgląd avatara" src="https://via.placeholder.com/96x96?text=Avatar">
                <div>
                  <input type="file" id="pf_avatar_file" accept="image/png,image/jpeg,image/webp" />
                  <div style="display:flex;gap:.5rem;margin-top:.5rem;flex-wrap:wrap">
                    <button type="button" class="btn primary small" id="pf_avatar_upload">Prześlij</button>
                    <button type="button" class="btn ghost small" id="pf_avatar_remove">Usuń</button>
                    <span id="pf_avatar_msg" class="tiny muted" aria-live="polite"></span>
                  </div>
                  <p class="tiny muted" style="margin:.3rem 0 0">Obsługiwane: JPG/PNG/WebP, do 3&nbsp;MB.</p>
                </div>
              </div>
            </div>

            <label>Avatar URL
              <input id="pf_avatar" placeholder="https://...">
            </label>
            <label>Slug (adres profilu) — unikalny
              <input id="pf_slug" placeholder="np. anna-nowak">
            </label>
          </div>
          <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem">
            <button class="btn primary" type="submit">Zapisz profil</button>
            <span id="pf_msg" class="tiny muted" aria-live="polite"></span>
          </div>
        </form>
      </div>

      <div class="panel pad" style="margin-top:1rem">
        <h3>Twój grafik</h3>
        <div class="cal">
          <div class="cal-header">
            <button class="btn ghost small" id="calPrev">←</button>
            <div><strong id="calLabel">—</strong></div>
            <button class="btn ghost small" id="calNext">→</button>
          </div>
          <div class="cal-week">
            <div>Pn</div><div>Wt</div><div>Śr</div><div>Cz</div><div>Pt</div><div>Sb</div><div>Nd</div>
          </div>
          <div class="cal-grid" id="calGrid"></div>
        </div>

        <div class="hr"></div>

        <div class="grid" style="display:grid;grid-template-columns:1.2fr .8fr;gap:1rem">
          <div>
            <h4>Terminy w wybranym dniu</h4>
            <div id="dayEventsBox" class="tiny muted">Wybierz dzień w kalendarzu.</div>
          </div>
          <div>
            <h4>Dodaj termin</h4>
            <form id="calAddForm" class="form">
              <label>Data
                <input type="date" id="evDate" required>
              </label>
              <label>Start (HH:MM)
                <input type="time" id="evStart" required>
              </label>
              <label>Czas (min)
                <input type="number" id="evDur" value="60" min="15" step="15" required>
              </label>
              <label>Tytuł
                <input id="evTitle" placeholder="Lekcja 1:1" required>
              </label>
              <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem">
                <button class="btn primary" type="submit">Dodaj</button>
                <span id="evMsg" class="tiny muted"></span>
              </div>
            </form>
          </div>
        </div>
      </div>

    </div>
  </section>
</main>

<!-- ========== REGULAMIN ========= -->
<main id="view-regulamin" class="view">
  <section class="section"><div class="wrap">
    <h2>Regulamin świadczenia usług</h2>
    <article class="panel pad prose">
      <p><strong>Administrator:</strong> [Nazwa firmy / Błażej Hordyk], [adres], NIP: [NIP], e-mail: [kontakt@twojadomena.pl].</p>
      <h3>1. Postanowienia ogólne</h3><ul><li>Regulamin określa zasady świadczenia usług nauczania językowego online.</li><li>Akceptacja Regulaminu następuje przy zapisie lub płatności.</li></ul>
      <h3>2. Zakres usług</h3><p>Indywidualne lekcje 1:1 oraz szkolenia dla firm.</p>
      <h3>3. Rezerwacje i odwołania</h3><ul><li>Zmiana/odwołanie min. 24h przed terminem.</li></ul>
      <h3>4. Płatności</h3><ul><li>Płatność z góry; faktury na życzenie.</li></ul>
      <h3>5. Materiały i prawa autorskie</h3><p>Tylko do użytku własnego.</p>
      <h3>6. Odpowiedzialność</h3><p>W razie awarii po stronie szkoły zajęcia przenoszone.</p>
      <h3>7. Reklamacje</h3><p>kontakt@twojadomena.pl – 14 dni na rozpatrzenie.</p>
      <h3>8. Zmiany Regulaminu</h3><p>Informujemy z wyprzedzeniem.</p>
      <h3>9. Postanowienia końcowe</h3><p>Prawo polskie, sąd właściwy dla siedziby.</p>
    </article>
  </div></section>
</main>

<!-- ========== RODO ========= -->
<main id="view-rodo" class="view">
  <section class="section"><div class="wrap">
    <h2>Polityka prywatności (RODO)</h2>
    <article class="panel pad prose">
      <p><strong>Administrator danych:</strong> [Nazwa firmy / Błażej Hordyk], [adres], NIP: [NIP], e-mail: [kontakt@twojadomena.pl].</p>
      <h3>1. Zakres danych</h3><p>Imię, e-mail, telefon (opcjonalnie), dane rozliczeniowe.</p>
      <h3>2. Cele</h3><ul><li>Realizacja usług</li><li>Rozliczenia</li><li>Kontakt</li><li>Newsletter (za zgodą)</li></ul>
      <h3>3. Odbiorcy</h3><p>Rezerwacje, płatności, formularze, e-mail.</p>
      <h3>4. Poza EOG</h3><p>Standardowe klauzule umowne.</p>
      <h3>5. Okres</h3><p>Na czas usług i wymogów prawnych.</p>
      <h3>6. Prawa</h3><ul><li>Dostęp, sprostowanie, usunięcie, ograniczenie, przeniesienie, sprzeciw.</li></ul>
      <h3>7. Cookies</h3><p>Zarządzanie w ustawieniach przeglądarki lub w <a href="#cookies">Ustawieniach cookies</a>.</p>
      <h3>8. Kontakt</h3><p>[kontakt@twojadomena.pl]</p>
    </article>
  </div></section>
</main>

<section class="footer">
  <div class="wrap">
    <div><strong>Szkoła Językowa Błażej Hordyk</strong></div>
    <div>
      <a href="#home">Start</a> · <a href="#lektorzy">Lektorzy</a> · <a href="#kursy">Kursy</a> · <a href="#cennik">Cennik</a> · <a href="#probna">Lekcja próbna</a> · <a href="#test">Test</a> · <a href="#materialy">Materiały</a> · <a href="#plan">Plan</a> · <a href="#opinie">Opinie</a> · <a href="#slownik">Słownik</a> · <a href="#wydarzenia">Wydarzenia</a> · <a href="#b2b-rozwiązania">B2B</a> · <a href="#case">Case</a> · <a href="#roi">ROI</a> · <a href="#brief">Brief</a> · <a href="#b2b-cennik">B2B cennik</a> · <a href="#kariera">Kariera</a> · <a href="#lektor-materialy">Lektor materiały</a> · <a href="#lektor-faq">FAQ lektora</a> · <a href="#sklep">Sklep</a> · <a href="#ielts">IELTS</a> · <a href="#fce">FCE</a> · <a href="#business-english">Business English</a> · <a href="#polecenia">Polecenia</a> · <a href="#media">Media</a> · <a href="#certyfikaty">Certyfikaty</a> · <a href="#dostepnosc">Dostępność</a> · <a href="#help">Pomoc</a> · <a href="#cookies">Cookies</a> · <a href="#status">Status</a> · <a href="#regulamin">Regulamin</a> · <a href="#rodo">RODO</a> · <a href="#mapa-strony">Mapa</a>
    </div>
  </div>
</section>

<script>
/* ========= KONFIG SUPABASE ========= */
const SUPABASE_URL = "https://YOUR-PROJECT.supabase.co"; // ← PODMIEŃ
const SUPABASE_ANON_KEY = "YOUR-ANON-KEY";               // ← PODMIEŃ
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* ========= DANE DEMO ========= */
const TUTORS = [
  { id:"blazej-hordyk", name:"Błażej Hordyk", title:"Lektor angielskiego • konwersacje bez stresu", avatar:"https://images.unsplash.com/photo-1520975693415-1f9b6c1b0e47?q=80&w=300&auto=format&fit=crop", langs:["angielski (C2)","polski (ojczysty)"], specs:["od podstaw","angielski do pracy","konwersacje"], rate:120, bio:"Uczę w spokojnej, wspierającej atmosferze. Stawiam na mówienie, naturalne zwroty i plan dopasowany do Twoich celów.", booking:"https://calendly.com/example/lekcja-60", email:"kontakt@twojadomena.pl", pay4:"https://buy.stripe.com/your_link_4", pay8:"https://buy.stripe.com/your_link_8"},
  { id:"anna-nowak", name:"Anna Nowak", title:"Business English • maile i spotkania", avatar:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=300&auto=format&fit=crop", langs:["angielski (C1)","polski (ojczysty)"], specs:["Business English","prezentacje","rozmowy rekrutacyjne"], rate:140, bio:"Pomagam nabrać pewności podczas spotkań i prezentacji. Realne scenariusze i szybki feedback.", booking:"https://calendly.com/example/business-60", email:"anna@example.com", pay4:"#", pay8:"#"},
  { id:"michal-kowalski", name:"Michał Kowalski", title:"Egzaminy i struktury • FCE/IELTS", avatar:"https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=300&auto=format&fit=crop", langs:["angielski (C2)","polski (ojczysty)"], specs:["FCE/IELTS","gramatyka jasno","strategie egzaminacyjne"], rate:130, bio:"Uczę tak, żeby struktury były proste. Plan pod wynik, próbne testy, techniki egzaminacyjne.", booking:"https://calendly.com/example/exam-60", email:"michal@example.com", pay4:"#", pay8:"#"}
];

const BLOG = [
  { id:"bariera-mowienia", title:"Jak przełamać barierę mówienia?", cat:"od-podstaw", excerpt:"3 proste kroki, które działają u większości osób już po tygodniu.", content:`<p>Najpierw <strong>mikro-sytuacje</strong> — potem <strong>parafrazy</strong> i <strong>rozszerzenia</strong>.</p>` },
  { id:"mail-po-angielsku", title:"Mail po angielsku w pracy: szybki szablon", cat:"business", excerpt:"Krótko, uprzejmie i konkretnie. Oto uniwersalny schemat.", content:`<p><strong>Subject:</strong> Action needed: … / Update on …<br><em>Next step</em>: co i kiedy.</p>` },
  { id:"ielts-writing", title:"IELTS Writing: 3 błędy, które psują wynik", cat:"egzaminy", excerpt:"Proste zamienniki podnoszą punktację.", content:`<ul><li>Unikaj very + adj</li><li>Precyzja w danych</li><li>Łączniki tematyczne</li></ul>` }
];

const CASES = [
  { company:"TechWave (IT)", goal:"Płynność na daily i demos", action:"Role-plays + słownictwo projektowe", result:"Skrócenie spotkań o 18%", quote:"„Wreszcie konkret – bez książkowego bełkotu.”" },
  { company:"SalesPro (sprzedaż)", goal:"Lepszy discovery i closing", action:"Skrypty + improwizacje", result:"Wyższy win-rate +11%", quote:"„Zespół brzmi naturalnie i pewnie.”" }
];

const DICT = [
  { term:"circle back", pl:"wrócić do tematu", cat:"business" },
  { term:"takeaways", pl:"wnioski/kluczowe punkty", cat:"spotkania" },
  { term:"band score", pl:"wynik punktowy (IELTS)", cat:"egzaminy" },
  { term:"follow up", pl:"dalszy krok/kontakt", cat:"business" }
];

const MATERIALS = [
  { title:"Checklist: Small Talk w pracy", level:"B1", type:"PDF" },
  { title:"Audio: wymowa th / r", level:"A2", type:"Audio" },
  { title:"Video: Prezentacje – wstęp i zakończenie", level:"B2", type:"Video" },
  { title:"PDF: IELTS Writing – łączniki", level:"B2", type:"PDF" }
];

const OPEN_EVENTS = [
  { title:"Konwersacje grupowe (B1)", when:"Wt 19:00–19:45", seats:4 },
  { title:"Warsztat: Maile w pracy", when:"Czw 18:00–19:00", seats:8 }
];

const SHOP = [
  { sku:"single60", title:"1 × 60 min", price:"XX zł", link:"#"},
  { sku:"pack4", title:"Pakiet 4 × 60 min", price:"XX zł", link:"#"},
  { sku:"pack8", title:"Pakiet 8 × 60 min", price:"XX zł", link:"#"}
];

const OPINIE = [
  { name:"Ewa", text:"Po miesiącu zaczęłam mówić płynniej na spotkaniach. Zero stresu!", stars:5 },
  { name:"Kamil", text:"Świetne przygotowanie do IELTS – konkretny feedback.", stars:5 },
  { name:"Ola", text:"Wreszcie rozumiem gramatykę bez bólu głowy.", stars:5 }
];

/* ========= HELPERY ========= */
const $ = (s, r=document)=>r.querySelector(s);
const $all = (s, r=document)=>[...r.querySelectorAll(s)];
const tag = x => `<span class="tag">${x}</span>`;
const tutorById = id => TUTORS.find(t=>t.id===id);
const fmtDate = dt => new Date(dt).toLocaleString('pl-PL',{dateStyle:'medium',timeStyle:'short'});

/* Daty / kalendarz */
const MONTHS_PL = ["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"];
function startOfMonth(y,m){ return new Date(Date.UTC(y,m,1,0,0,0)); }
function endOfMonth(y,m){ return new Date(Date.UTC(y,m+1,1,0,0,0)); } // exclusive
function toISO(d){ return new Date(d).toISOString(); }
function ymd(d){ const x=new Date(d); const y=x.getFullYear(), m=String(x.getMonth()+1).padStart(2,'0'), da=String(x.getDate()).padStart(2,'0'); return `${y}-${m}-${da}`; }
function isSameDay(a,b){ const A=new Date(a),B=new Date(b); return A.getFullYear()===B.getFullYear() && A.getMonth()===B.getMonth() && A.getDate()===B.getDate(); }
function fileExtFromMime(mime){ if(mime==='image/png')return 'png'; if(mime==='image/webp')return 'webp'; return 'jpg'; }

/* ========= ROUTER ========= */
async function showView(name){ $all('.view').forEach(v=>v.classList.remove('active')); const v=$(`#view-${name}`); if(v) v.classList.add('active'); }
window.addEventListener('hashchange', parseHash);

async function parseHash(){
  const hash = (location.hash||'#home').replace('#','');
  if (hash.startsWith('post?id=')){ renderPost(hash.split('=')[1]); return showView('post'); }
  if (hash.startsWith('lektor?id=')){ renderProfile(hash.split('=')[1]); return showView('lektor'); }

  const routes = ['home','lektorzy','lektor','kursy','cennik','blog','post','kontakt','rekrutacja','login','panel','regulamin','rodo',
  'b2b-rozwiązania','case','roi','brief','b2b-cennik','kariera','lektor-materialy','lektor-faq','sklep','ielts','fce','business-english',
  'polecenia','opinie','probna','faq-rozszerzone','slownik','wydarzenia','test','materialy','plan','uczen','dostepnosc','mapa-strony','help','cookies','status','o-nas','firmy'];
  if (routes.includes(hash)){
    if (hash==='blog'){ renderBlogList(); }
    if (hash==='case'){ renderCases(); }
    if (hash==='lektorzy'){ renderTutors(); }
    if (hash==='sklep'){ renderShop(); }
    if (hash==='opinie'){ renderOpinie(); }
    if (hash==='slownik'){ renderDict(); }
    if (hash==='wydarzenia'){ renderOpenEvents(); }
    if (hash==='materialy'){ renderMaterials(); }
    if (hash==='mapa-strony'){ renderSitemap(); }
    if (hash==='lektor-materialy'){ renderLektorMateriałyGate(); }
    if (hash==='panel'){ await showPanel(); return; }
    if (hash==='login'){ await showView('login'); return; }
    return showView(hash);
  }
  return showView('home');
}

/* ========= LISTA LEKTORÓW ========= */
function renderTutors(){
  const list = $("#tutorsList"); if (!list) return;
  const q = ($("#filterName")?.value || "").toLowerCase();
  const spec = $("#filterSpec")?.value || "all";
  const filtered = TUTORS.filter(t=>{
    const nameOk = !q || t.name.toLowerCase().includes(q) || t.title.toLowerCase().includes(q) || t.specs.join(' ').toLowerCase().includes(q);
    const specOk = spec === "all" || t.specs.includes(spec);
    return nameOk && specOk;
  });
  list.innerHTML = filtered.map(t=>`
    <article class="card tutor">
      <img src="${t.avatar}" alt="${t.name}" width="86" height="86">
      <div>
        <h3><a href="#lektor?id=${t.id}">${t.name}</a></h3>
        <p>${t.title}</p>
        <div class="tags">${t.specs.map(tag).join("")}</div>
        <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.4rem">
          <a class="btn primary" href="#lektor?id=${t.id}">Profil i zapisy</a>
          <a class="btn ghost" href="${t.booking}" target="_blank" rel="noopener">Szybka rezerwacja</a>
        </div>
      </div>
    </article>
  `).join('') || `<p class="muted">Brak wyników.</p>`;
}
$("#filterName")?.addEventListener('input', renderTutors);
$("#filterSpec")?.addEventListener('change', renderTutors);

/* ========= PROFIL LEKTORA (z bazy; fallback do TUTORS) ========= */
async function renderProfile(id){
  const box = $("#profileBox"); if(!box) return;
  let tDB = null;
  try{
    const { data } = await supabase.from('tutors').select('*').eq('slug', id).single();
    tDB = data || null;
  }catch(e){ /* ignore */ }
  const t = tDB ? {
    id: tDB.slug, name: tDB.name, title: tDB.title || '', avatar: tDB.avatar_url || '',
    langs: [], specs: Array.isArray(tDB.specs)?tDB.specs:[], rate: tDB.rate || '', bio: tDB.bio || '',
    booking: tDB.booking_url || '#', email: tDB.email || ''
  } : (TUTORS.find(x=>x.id===id) || TUTORS[0]);

  box.innerHTML = `
    <div class="panel pad">
      <div class="hero-box">
        <img src="${t.avatar||'https://via.placeholder.com/120x120?text=Avatar'}" alt="${t.name}" width="120" height="120">
        <div>
          <h1 style="margin:.2rem 0 .4rem">${t.name}</h1>
          <p class="lead" style="margin:.2rem 0">${t.title||''}</p>
          <div class="meta">${(t.langs||[]).map(tag).join("")}${(t.specs||[]).map(tag).join("")}</div>
          ${t.rate? `<p class="muted" style="margin:.4rem 0 0">Stawka orientacyjna: <strong>${t.rate} zł / 60 min</strong></p>`:''}
          <div style="margin:.8rem 0;display:flex;gap:.5rem;flex-wrap:wrap">
            ${t.booking? `<a class="btn primary" href="${t.booking}" target="_blank" rel="noopener">Zarezerwuj termin</a>`:''}
            ${t.email? `<a class="btn ghost" href="mailto:${t.email}?subject=Zapytanie%20o%20zajecia%20z%20${encodeURIComponent(t.name)}">Napisz do lektora</a>`:''}
            <a class="btn" href="#lektorzy">← Wróć do listy</a>
          </div>
        </div>
      </div>
      <hr class="hr">
      ${t.bio? `<h2>O lektorze</h2><p>${t.bio}</p>`:''}
    </div>
    ${t.booking? `<div class="panel pad"><h2>Rezerwacja terminu</h2><iframe class="iframe-card" src="${t.booking}" loading="lazy" title="Kalendarz ${t.name}"></iframe></div>`:''}
  `;
}

/* ========= BLOG ========= */
function renderBlogList(){
  const catSel = $('#blogCat'); const qInp = $('#blogQ'); const box = $('#blogList');
  const cat = catSel?.value || 'all'; const q = (qInp?.value||'').toLowerCase();
  const filtered = BLOG.filter(p=>(cat==='all'||p.cat===cat) && (!q || p.title.toLowerCase().includes(q) || p.excerpt.toLowerCase().includes(q)));
  box.innerHTML = filtered.map(p=>`
    <article class="card">
      <h3>${p.title}</h3>
      <p class="tiny muted">Kategoria: ${p.cat}</p>
      <p>${p.excerpt}</p>
      <p><a class="btn primary small" href="#post?id=${p.id}">Czytaj</a></p>
    </article>`).join('') || `<p class="muted">Brak wpisów.</p>`;
}
$('#blogCat')?.addEventListener('change', renderBlogList);
$('#blogQ')?.addEventListener('input', renderBlogList);
function renderPost(id){ const p=BLOG.find(x=>x.id===id)||BLOG[0]; $('#postBox').innerHTML = `<h1>${p.title}</h1><div class="tiny muted">Kategoria: ${p.cat}</div>${p.content}`; }

/* ========= CENNIK kalkulator ========= */
function calc(){
  const rate = parseFloat($('#rate').value||'0'), duration = parseInt($('#duration').value,10), lessons = parseInt($('#lessons').value,10);
  const r = $('#calcResult'); if(!rate||!duration||!lessons){ r.textContent='Uzupełnij pola'; return; }
  const per = rate*(duration/60), base = per*lessons; let disc=0; if(lessons>=12)disc=.10; else if(lessons>=8)disc=.05;
  const total = Math.round((base*(1-disc))*100)/100, saved=Math.round((base-total)*100)/100;
  r.innerHTML = `<strong>Razem: ${total.toLocaleString('pl-PL')} zł</strong> ${saved>0?`• oszczędzasz ${saved.toLocaleString('pl-PL')} zł`:''}
  <br><span class="tiny">(${lessons} × ${Math.round(per)} zł/lekcję, ${duration} min)</span>`;
}
$('#calcBtn')?.addEventListener('click', calc);

/* ========= CASES ========= */
function renderCases(){
  $('#caseList').innerHTML = CASES.map(c=>`
    <article class="card">
      <h3>${c.company}</h3>
      <p><strong>Cel:</strong> ${c.goal}</p>
      <p><strong>Co zrobiliśmy:</strong> ${c.action}</p>
      <p><strong>Wynik:</strong> ${c.result}</p>
      <p class="tiny muted">„${c.quote}”</p>
    </article>`).join('');
}

/* ========= ROI ========= */
$('#roiBtn')?.addEventListener('click', ()=>{
  const rate=+$('#roiRate').value||0, meet=+$('#roiMeet').value||0, cut=(+$('#roiCut').value||0)/100, ppl=+$('#roiPeople').value||1;
  const savedHours = meet*cut*ppl; const savedPLN = savedHours*rate*4; // mies.
  $('#roiOut').innerHTML = `<strong>Szacowana oszczędność: ${Math.round(savedPLN).toLocaleString('pl-PL')} zł / miesiąc</strong>
  <br><span class="tiny">Założenie: krótsze spotkania, 4 tygodnie.</span>`;
});

/* ========= SKLEP ========= */
function renderShop(){
  $('#shopList').innerHTML = SHOP.map(p=>`
    <article class="card">
      <h3>${p.title}</h3><p class="price">${p.price}</p>
      <p><a class="btn primary small" href="${p.link}">Kup teraz</a></p>
    </article>`).join('');
}

/* ========= OPINIE ========= */
function renderOpinie(){
  $('#opinieList').innerHTML = OPINIE.map(o=>`
    <div class="panel pad"><strong>${o.name}</strong> — ${'⭐'.repeat(o.stars)}<p>${o.text}</p></div>`).join('');
}

/* ========= PROGRAM POLECEŃ ========= */
$('#mkRef')?.addEventListener('click', ()=>{
  const n = ($('#refName').value||'user').toLowerCase().replace(/\s+/g,'-');
  const m = btoa($('#refMail').value||'');
  const link = location.origin+location.pathname+'#probna?ref='+encodeURIComponent(n)+'&id='+m;
  $('#refOut').innerHTML = `<strong>Twój link:</strong> <a href="${link}">${link}</a>`;
});

/* ========= SŁOWNIK ========= */
function renderDict(){
  const q = ($('#dictQ').value||'').toLowerCase();
  const cat = $('#dictCat').value||'all';
  const list = DICT.filter(d=>(cat==='all'||d.cat===cat) && (!q || d.term.includes(q)||d.pl.includes(q)));
  $('#dictList').innerHTML = list.map(d=>`<div class="panel pad"><strong>${d.term}</strong> — ${d.pl} <span class="tiny muted">(${d.cat})</span></div>`).join('') || `<p class="muted">Brak wyników.</p>`;
}
$('#dictQ')?.addEventListener('input', renderDict);
$('#dictCat')?.addEventListener('change', renderDict);

/* ========= WYDARZENIA (public demo) ========= */
function renderOpenEvents(){
  $('#eventsOpen').innerHTML = OPEN_EVENTS.map(e=>`<div class="panel pad"><strong>${e.title}</strong><br><span class="tiny muted">${e.when} • miejsca: ${e.seats}</span></div>`).join('');
}

/* ========= MATERIAŁY ========= */
function renderMaterials(){
  const lvl = $('#matLevel').value||'all', t = $('#matType').value||'all';
  const data = MATERIALS.filter(x=>(lvl==='all'||x.level===lvl)&&(t==='all'||x.type===t));
  $('#matList').innerHTML = data.map(x=>`<article class="card"><h3>${x.title}</h3><p class="tiny muted">${x.level} • ${x.type}</p><p><a class="btn ghost small" href="#">Pobierz</a></p></article>`).join('') || `<p class="muted">Brak materiałów.</p>`;
}
$('#matLevel')?.addEventListener('change', renderMaterials);
$('#matType')?.addEventListener('change', renderMaterials);

/* ========= MAPA STRONY ========= */
function renderSitemap(){
  const links = [...$all('.footer a')].map(a=>a.getAttribute('href')).filter(h=>h?.startsWith('#'));
  $('#sitemap').innerHTML = [...new Set(links)].map(h=>`<div><a class="btn ghost small" href="${h}">${h.replace('#','/')}</a></div>`).join('');
}

/* ========= STREFA KURSANTA ========= */
$('#uSave')?.addEventListener('click', ()=>{ localStorage.setItem('uNotes',$('#uNotes').value||''); $('#uMsg').textContent='Zapisano ✔'; setTimeout(()=>$('#uMsg').textContent='',2000); });
function loadUczen(){ $('#uNotes').value = localStorage.getItem('uNotes')||''; $('#uSchedule').innerHTML = `<div class="panel pad">Wt 18:00 — Konwersacje (B1)</div><div class="panel pad">Czw 19:00 — Business email</div>`; }

/* ========= LEKTOR MATERIAŁY: ochrona (soft) ========= */
async function renderLektorMateriałyGate(){
  const { data:{session} } = await supabase.auth.getSession();
  const box = $('#lmBox');
  if (!session){ box.innerHTML = `Dostęp tylko dla zalogowanych lektorów. <a class="btn primary small" href="#login">Zaloguj się</a>`; return; }
  box.innerHTML = `<div class="cards">
    <article class="card"><h3>Checklist: Lekcja 1:1</h3><p>Cel • praktyka • feedback • HW</p></article>
    <article class="card"><h3>Rubryka oceny Speaking</h3><p>B1–C1: fluency, accuracy, range</p></article>
    <article class="card"><h3>Bank ćwiczeń</h3><p>Role-plays, parafrazy, rozszerzenia</p></article>
  </div>`;
}

/* ========= AUTH UI ========= */
async function refreshAuthUI(){
  const { data:{session} } = await supabase.auth.getSession();
  const isIn = !!session;
  $('#navPanel').style.display = isIn ? '' : 'none';
  $('#navLogout').style.display = isIn ? '' : 'none';
  $('#navLogin').style.display = isIn ? 'none' : '';
}

/* ========= DB: upewnij wiersz tutora (z unikalnym slugiem) ========= */
async function ensureTutorRow(user){
  const { data: row } = await supabase.from('tutors').select('*').eq('user_id', user.id).maybeSingle();
  if (row) return row;
  const baseSlug = (user.email?.split('@')[0] || 'lektor').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
  let slug = baseSlug, i=1;
  while(true){
    const { data: c } = await supabase.from('tutors').select('id').eq('slug', slug).maybeSingle();
    if (!c) break; i++; slug = `${baseSlug}-${i}`;
  }
  const guessName = user.user_metadata?.name || user.email || 'Lektor';
  const { data, error } = await supabase.from('tutors').insert({
    user_id: user.id, slug, name: guessName, email: user.email,
    title: '', bio:'', avatar_url:'', rate: 120, specs: [], booking_url:''
  }).select('*').single();
  if (error) throw error;
  return data;
}

/* ========= PANEL: kalendarz/grafik ========= */
let CAL_STATE = { y:0, m:0, selected:null, tutorId:null, events:[] };

function calLabel(y,m){ const months = ["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"]; return `${months[m]} ${y}`; }
function buildMonthCells(y,m){
  const first = new Date(Date.UTC(y,m,1));
  const startDay = (first.getUTCDay() + 6) % 7; // pon=0
  const daysInMonth = new Date(Date.UTC(y,m+1,0)).getUTCDate();
  const prevDays = startDay;
  const total = Math.ceil((prevDays + daysInMonth)/7)*7;
  const cells = [];
  for(let i=0;i<total;i++){
    const dayNum = i - prevDays + 1;
    let date;
    if (dayNum < 1){ const d = new Date(Date.UTC(y,m,1)); d.setUTCDate(dayNum); date = d; }
    else if (dayNum > daysInMonth){ const d = new Date(Date.UTC(y,m,1)); d.setUTCDate(dayNum); date = d; }
    else { date = new Date(Date.UTC(y,m,dayNum)); }
    cells.push(date);
  }
  return cells;
}

async function refreshCalendar(){
  const y = CAL_STATE.y, m = CAL_STATE.m;
  $('#calLabel').textContent = calLabel(y,m);
  const monthStart = startOfMonth(y,m);
  const monthEnd = endOfMonth(y,m);

  const { data, error } = await supabase
    .from('events')
    .select('id,title,start,end,status')
    .eq('tutor_id', CAL_STATE.tutorId)
    .gte('start', toISO(monthStart))
    .lt('start', toISO(monthEnd))
    .order('start', { ascending: true });

  CAL_STATE.events = error ? [] : (data||[]);

  const grid = $('#calGrid'); grid.innerHTML = '';
  const cells = buildMonthCells(y,m);
  const today = new Date();

  cells.forEach(d=>{
    const inThisMonth = d.getUTCMonth() === m;
    const has = CAL_STATE.events.filter(ev => isSameDay(ev.start, d));
    const div = document.createElement('div');
    div.className = 'cal-cell' + (inThisMonth ? '' : ' other') + (isSameDay(d, today) ? ' today' : '');
    div.setAttribute('data-date', ymd(d));
    div.innerHTML = `<div class="d">${d.getUTCDate()}</div><div class="dots">${
      has.map(ev=>`<span class="dot ${ev.status==='booked'?'bad':''}"></span>`).join('')
    }</div>`;
    div.addEventListener('click', ()=>selectCalendarDay(d));
    grid.appendChild(div);
  });

  const candidate = cells.find(c=>isSameDay(c,today) && c.getUTCMonth()===m) || new Date(Date.UTC(y,m,1));
  selectCalendarDay(candidate);
}

function selectCalendarDay(d){ CAL_STATE.selected = d; $('#evDate').value = ymd(d); renderDayEvents(); }

function renderDayEvents(){
  const box = $('#dayEventsBox');
  if (!CAL_STATE.selected){ box.textContent = 'Wybierz dzień w kalendarzu.'; return; }
  const list = CAL_STATE.events.filter(ev => isSameDay(ev.start, CAL_STATE.selected));
  if (!list.length){ box.innerHTML = `<p class="muted">Brak terminów w tym dniu.</p>`; return; }
  box.innerHTML = list.map(ev=>`
    <div class="ev ${ev.status==='booked'?'booked':'free'}">
      <strong>${ev.title}</strong><br>
      ${fmtDate(ev.start)} – ${fmtDate(ev.end)} • <span class="tiny muted">${ev.status||'free'}</span>
      <div class="actions">
        <button class="btn ghost small" data-act="toggle" data-id="${ev.id}">${ev.status==='booked'?'Oznacz jako FREE':'Oznacz jako BOOKED'}</button>
        <button class="btn ghost small" data-act="del" data-id="${ev.id}">Usuń</button>
      </div>
    </div>
  `).join('');

  box.querySelectorAll('button[data-act="toggle"]').forEach(b=>{
    b.addEventListener('click', async ()=>{
      const id = b.getAttribute('data-id');
      const ev = CAL_STATE.events.find(x=>x.id===id);
      const next = ev.status==='booked'?'free':'booked';
      await supabase.from('events').update({ status: next }).eq('id', id);
      await refreshCalendar();
    });
  });
  box.querySelectorAll('button[data-act="del"]').forEach(b=>{
    b.addEventListener('click', async ()=>{
      const id = b.getAttribute('data-id');
      await supabase.from('events').delete().eq('id', id);
      await refreshCalendar();
    });
  });
}

function bindCalendarUI(){
  $('#calPrev').onclick = async ()=>{ CAL_STATE.m--; if(CAL_STATE.m<0){ CAL_STATE.m=11; CAL_STATE.y--; } await refreshCalendar(); };
  $('#calNext').onclick = async ()=>{ CAL_STATE.m++; if(CAL_STATE.m>11){ CAL_STATE.m=0; CAL_STATE.y++; } await refreshCalendar(); };
}

function bindCalAddForm(){
  const form = $('#calAddForm'); const msg = $('#evMsg');
  form.onsubmit = async (e)=>{
    e.preventDefault();
    const date = $('#evDate').value, start = $('#evStart').value, dur = parseInt($('#evDur').value,10)||60, title = $('#evTitle').value.trim()||'Lekcja 1:1';
    if (!date || !start){ msg.textContent='Uzupełnij datę i godzinę.'; msg.style.color='var(--danger)'; return; }
    const s = new Date(`${date}T${start}:00`), e2 = new Date(s.getTime() + dur*60000);
    const { error } = await supabase.from('events').insert({ tutor_id: CAL_STATE.tutorId, title, start: s.toISOString(), end: e2.toISOString(), status: 'free' });
    if (error){ msg.textContent='Błąd: '+error.message; msg.style.color='var(--danger)'; }
    else{ msg.textContent='Dodano termin.'; msg.style.color='var(--ok)'; form.reset(); $('#evDate').value = ymd(CAL_STATE.selected||new Date()); await refreshCalendar(); setTimeout(()=>{ msg.textContent=''; }, 1200); }
  };
}

/* ========= AVATAR: upload / remove ========= */
async function uploadAvatarForCurrentTutor(){
  const msg = $('#pf_avatar_msg'); msg.textContent = 'Wgrywam…';
  const { data:{session} } = await supabase.auth.getSession();
  if (!session){ msg.textContent = 'Brak sesji.'; msg.style.color='var(--danger)'; return; }
  const user = session.user;

  const input = $('#pf_avatar_file');
  if (!input.files || !input.files[0]){ msg.textContent='Wybierz plik.'; msg.style.color='var(--danger)'; return; }
  const file = input.files[0];
  if (!/^image\/(png|jpeg|webp)$/.test(file.type)){ msg.textContent='Nieobsługiwany format.'; msg.style.color='var(--danger)'; return; }
  if (file.size > 3*1024*1024){ msg.textContent='Plik > 3 MB.'; msg.style.color='var(--danger)'; return; }

  const ext = fileExtFromMime(file.type);
  const path = `${user.id}/avatar.${ext}`;
  const { error: upErr } = await supabase.storage.from('avatars').upload(path, file, { upsert:true, contentType:file.type, cacheControl:'3600' });
  if (upErr){ msg.textContent = 'Błąd uploadu: ' + upErr.message; msg.style.color='var(--danger)'; return; }

  const { data: pub } = await supabase.storage.from('avatars').getPublicUrl(path);
  const publicUrl = pub?.publicUrl;

  const { data: trow } = await supabase.from('tutors').select('id').eq('user_id', user.id).single();
  if (!trow){ msg.textContent='Nie znaleziono profilu tutora.'; msg.style.color='var(--danger)'; return; }

  const { error: upTutorErr } = await supabase.from('tutors').update({ avatar_url: publicUrl }).eq('id', trow.id);
  if (upTutorErr){ msg.textContent = 'Błąd zapisu profilu: ' + upTutorErr.message; msg.style.color='var(--danger)'; return; }

  $('#pf_avatar_preview').src = publicUrl;
  $('#pf_avatar').value = publicUrl;
  msg.textContent = 'Zaktualizowano avatar ✔'; msg.style.color='var(--ok)';
  setTimeout(()=>{ msg.textContent=''; }, 1500);
}

async function removeAvatarForCurrentTutor(){
  const msg = $('#pf_avatar_msg'); msg.textContent = 'Usuwam…';
  const { data:{session} } = await supabase.auth.getSession();
  if (!session){ msg.textContent='Brak sesji.'; msg.style.color='var(--danger)'; return; }
  const user = session.user;

  const paths = [`${user.id}/avatar.jpg`, `${user.id}/avatar.png`, `${user.id}/avatar.webp`];
  await supabase.storage.from('avatars').remove(paths);

  const { data: trow } = await supabase.from('tutors').select('id').eq('user_id', user.id).single();
  if (trow){ await supabase.from('tutors').update({ avatar_url: null }).eq('id', trow.id); }

  $('#pf_avatar_preview').src = 'https://via.placeholder.com/96x96?text=Avatar';
  $('#pf_avatar').value = ''; $('#pf_avatar_file').value = '';
  msg.textContent = 'Usunięto avatar.'; msg.style.color='var(--ok)';
  setTimeout(()=>{ msg.textContent=''; }, 1200);
}

/* ========= PANEL: show + bindings ========= */
async function showPanel(){
  const { data:{session} } = await supabase.auth.getSession();
  if (!session){ location.hash='#login'; return; }
  await showView('panel'); await refreshAuthUI();

  const user = session.user;
  const tutor = await ensureTutorRow(user);
  CAL_STATE.tutorId = tutor.id;

  $('#meName').textContent = tutor.name || '—';
  $('#meEmail').textContent = tutor.email || user.email || '—';
  $('#mePublic').innerHTML = `<a href="#lektor?id=${tutor.slug}">#lektor?id=${tutor.slug}</a>`;

  $('#pf_name').value = tutor.name || '';
  $('#pf_title').value = tutor.title || '';
  $('#pf_bio').value = tutor.bio || '';
  $('#pf_rate').value = tutor.rate || '';
  $('#pf_specs').value = (tutor.specs||[]).join(', ');
  $('#pf_booking').value = tutor.booking_url || '';
  $('#pf_avatar').value = tutor.avatar_url || '';
  $('#pf_slug').value = tutor.slug || '';
  $('#pf_avatar_preview').src = tutor.avatar_url || 'https://via.placeholder.com/96x96?text=Avatar';

  // local preview on choose
  $('#pf_avatar_file').onchange = ()=>{ const f=$('#pf_avatar_file').files?.[0]; if(f) $('#pf_avatar_preview').src = URL.createObjectURL(f); };
  $('#pf_avatar_upload').onclick = uploadAvatarForCurrentTutor;
  $('#pf_avatar_remove').onclick = removeAvatarForCurrentTutor;

  // Save profile
  $('#profileForm').onsubmit = async (e)=>{
    e.preventDefault();
    const body = {
      name: $('#pf_name').value.trim(),
      title: $('#pf_title').value.trim(),
      bio: $('#pf_bio').value.trim(),
      rate: parseInt($('#pf_rate').value||'0',10) || null,
      specs: $('#pf_specs').value.split(',').map(s=>s.trim()).filter(Boolean),
      booking_url: $('#pf_booking').value.trim(),
      avatar_url: $('#pf_avatar').value.trim(),
      slug: $('#pf_slug').value.trim().toLowerCase().replace(/[^a-z0-9-]+/g,'').replace(/^-+|-+$/g,'')
    };
    const { data, error } = await supabase.from('tutors').update(body).eq('id', tutor.id).select('*').single();
    const msg = $('#pf_msg');
    if (error){ msg.textContent = 'Błąd: ' + error.message; msg.style.color='var(--danger)'; }
    else{
      msg.textContent = 'Zapisano profil.'; msg.style.color='var(--ok)';
      $('#meName').textContent = data.name || '—';
      $('#mePublic').innerHTML = `<a href="#lektor?id=${data.slug}">#lektor?id=${data.slug}</a>`;
      setTimeout(()=>{ msg.textContent=''; }, 1500);
    }
  };

  // Calendar init
  const now = new Date();
  CAL_STATE.y = now.getFullYear(); CAL_STATE.m = now.getMonth();
  await refreshCalendar();
  bindCalendarUI();
  bindCalAddForm();
}

/* ========= AUTH actions ========= */
$('#loginForm')?.addEventListener('submit', async (e)=>{
  e.preventDefault(); const email=$('#loginEmail').value.trim(), password=$('#loginPassword').value, msg=$('#loginMsg');
  msg.textContent='Logowanie…';
  const { error } = await supabase.auth.signInWithPassword({ email, password });
  if (error){ msg.textContent='Błąd: '+error.message; return; }
  msg.textContent='Zalogowano.'; await refreshAuthUI(); location.hash='#panel';
});
$('#registerBtn')?.addEventListener('click', async ()=>{
  const email=$('#loginEmail').value.trim(), password=$('#loginPassword').value, msg=$('#loginMsg');
  if(!email||!password){ msg.textContent='Podaj e-mail i hasło.'; return; }
  msg.textContent='Tworzę konto…'; const { error } = await supabase.auth.signUp({ email, password });
  msg.textContent = error ? ('Błąd: '+error.message) : 'Konto utworzone. Sprawdź e-mail (potwierdzenie).';
});
$('#navLogout')?.addEventListener('click', async (e)=>{ e.preventDefault(); await supabase.auth.signOut(); await refreshAuthUI(); location.hash='#login'; });
supabase.auth.onAuthStateChange(async ()=>{ await refreshAuthUI(); });

/* ========= TEST POZIOMUJĄCY ========= */
$('#testForm')?.addEventListener('submit', (e)=>{
  e.preventDefault();
  const key = {q1:'went',q2:'had',q3:'for',q4:'be finished',q5:'Not at all, I’ll send it now.'};
  let score=0; Object.entries(key).forEach(([k,v])=>{ const a=(new FormData(e.target).get(k)||'').toString(); if(a===v) score++; });
  const map = score<=1?'A1':score===2?'A2':score===3?'B1':score===4?'B2':'C1';
  const out = $('#testOut'); out.style.display='block'; out.innerHTML = `<strong>Wynik wstępny: ${map}</strong> (${score}/5). <a href="#probna">Umów krótką konsultację</a> — doprecyzujemy poziom.`;
});

/* ========= COOKIES ========= */
function loadCookiesUI(){ $('#cStat').checked = localStorage.getItem('cStat')==='1'; $('#cMkt').checked = localStorage.getItem('cMkt')==='1'; }
$('#cSave')?.addEventListener('click', ()=>{ localStorage.setItem('cStat',$('#cStat').checked?'1':'0'); localStorage.setItem('cMkt',$('#cMkt').checked?'1':'0'); $('#cMsg').textContent='Zapisano'; setTimeout(()=>$('#cMsg').textContent='',1500); });

/* ========= START ========= */
document.addEventListener('DOMContentLoaded', async ()=>{
  await refreshAuthUI();
  parseHash();
  if (location.hash === '#lektorzy') renderTutors();
  if (location.hash === '#blog') renderBlogList();
  loadUczen(); loadCookiesUI(); renderSitemap();
});
</script>

</body>
</html>
